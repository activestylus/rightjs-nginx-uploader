/**
 * RightJS Additional visual effects module
 * http://rightjs.org/plugins/effects
 *
 * Copyright (C) 2008-2010 Nikolay Nemshilov
 */
(function(g){function p(a,b){for(var c=0,d=b.length,f=a.computedStyles(),j={},h;c<d;c++){h=b[c];if(h in f)j[h]=""+f[h]}return j}function k(a,b,c){c=q(c).compact();var d=o(c.last())?c.pop():{};b=new (e[b.capitalize()])(a,d);b.start.apply(b,c);return a}if(!g.Fx)throw"RightJS Fx is missing";var l=g,r=g.$w,q=g.$A,e=g.Fx,m=g.Class,i=g.Object,s=g.Element,n=g.defined,o=g.isHash,t=g.isString;e.Move=new m(e.Morph,{extend:{Options:i.merge(e.Options,{duration:"long",position:"absolute"})},prepare:function(a){return this.$super(this.getEndPosition(a))},
getEndPosition:function(a){var b=this.element.getStyle("position"),c={};if(b!="absolute"||b!="relative")this.element._.style.position=b=b=="fixed"?"absolute":"relative";if(a.top)a.y=a.top.toInt();if(a.left)a.x=a.left.toInt();var d=this.element.position(),f=this.getParentPosition(),j=d.x-f.x;f=d.y-f.y;if(this.options.position=="relative")if(b=="absolute"){if(n(a.x))a.x+=d.x;if(n(a.y))a.y+=d.x}else{if(n(a.x))a.x+=j;if(n(a.y))a.y+=f}else if(b=="relative"){if(n(a.x))a.x+=j-d.x;if(n(a.y))a.y+=f-d.y}for(var h in a)switch(h){case "top":case "left":break;
case "y":c.top=a.y+"px";break;case "x":c.left=a.x+"px";break;default:c[h]=a[h]}return c},getParentPosition:function(){e.Move.Dummy=e.Move.Dummy||new s("div",{style:"width:0;height:0;visibility:hidden"});this.element.insert(e.Move.Dummy,"before");var a=e.Move.Dummy.position();e.Move.Dummy.remove();return a}});e.Zoom=new m(e.Move,{PROPERTIES:r("width height lineHeight paddingTop paddingRight paddingBottom paddingLeft fontSize borderWidth"),extend:{Options:i.merge(e.Move.Options,{position:"relative",
duration:"normal",from:"center"})},prepare:function(a,b){return this.$super(this._getZoomedStyle(a,b))},_getZoomedStyle:function(a,b){var c=this._getProportion(a);return i.merge(this._getBasicStyle(c),this._getEndPosition(c),b)},_getProportion:function(a){if(o(a)){var b=$E("div").insertTo($E("div",{style:"visibility:hidden;float:left;height:0;width:0"}).insertTo(document.body)).setStyle(a);a=a.height?b.size().y/this.element.size().y:b.size().x/this.element.size().x;b.remove()}else if(t(a))a=l(a).endsWith("%")?
l(a).toFloat()/100:l(a).toFloat();return a},_getBasicStyle:function(a){function b(j){return""+l(j).toFloat()*a}var c=p(this.element,this.PROPERTIES),d=/([\d\.]+)/g;for(var f in c){if(f==="width"||f==="height")c[f]=c[f]||this.element["offset"+l(f).capitalize()]+"px";if(c[f].match(d))c[f]=c[f].replace(d,b);else delete c[f]}if(c.borderWidth&&l(c.borderWidth).toFloat()<1)c.borderWidth="1px";return c},_getEndPosition:function(a){var b={},c=this.element.size(),d=c.x*(a-1);a=c.y*(a-1);switch(this.options.from.replace("-",
" ").split(" ").sort().join("_")){case "top":b.x=-d/2;break;case "right":b.x=-d;b.y=-a/2;break;case "bottom":b.x=-d/2;case "bottom_left":b.y=-a;break;case "bottom_right":b.y=-a;case "right_top":b.x=-d;break;case "center":b.x=-d/2;case "left":b.y=-a/2;break;default:}return b}});e.Bounce=new m(e,{extend:{Options:i.merge(e.Options,{duration:"short",direction:"top",value:16})},prepare:function(a){a=a||this.options.value;this.element.position();var b={duration:e.Durations[this.options.duration]||this.options.duration,
position:"relative"},c="y";switch(this.options.direction){case "right":a=-a;case "left":c="x";break;case "bottom":a=-a}var d={},f={};d[c]=-a;f[c]=a;(new e.Move(this.element,b)).start(d);(new e.Move(this.element,b)).start(f);this.finish.bind(this).delay(1);return this}});e.Run=new m(e.Move,{extend:{Options:i.merge(e.Move.Options,{direction:"left"})},prepare:function(a){var b=a||"toggle";a={};var c=this.element.dimensions();if(b=="out"||b=="toggle"&&this.element.visible()){if(this.options.direction==
"left")a.x=-c.width-80;else a.y=-c.height-80;this.onFinish(function(){this.element.hide().setStyle(this.getEndPosition({x:c.left,y:c.top}))})}else{c=this.element.setStyle("visibility: hidden").show().dimensions();b={};if(this.options.direction=="left"){b.x=-c.width-80;a.x=c.left}else{b.y=-c.height-80;a.y=c.top}this.element.setStyle(this.getEndPosition(b)).setStyle("visibility: visible")}return this.$super(a)}});e.Puff=new m(e.Zoom,{extend:{Options:i.merge(e.Zoom.Options,{size:1.4})},prepare:function(a){var b=
a||"toggle",c=0;a=this.options.size;var d;if(b=="out"||b=="toggle"&&this.element.visible()){d=this.getEndPosition(this._getZoomedStyle(1));this.onFinish(function(){d.opacity=1;this.element.hide().setStyle(d)})}else{this.element.setStyle("visibility: visible").show();b=this.element.offsetWidth;d=this.getEndPosition(this._getZoomedStyle(1));this.onFinish(function(){this.element.setStyle(d)});this.element.setStyle(i.merge(this.getEndPosition(this._getZoomedStyle(a)),{opacity:0,visibility:"visible"}));
a=b/this.element.offsetWidth;c=1}return this.$super(a,{opacity:c})}});e.Glow=new m(e.Morph,{extend:{Options:i.merge(e.Options,{color:"#FF8",transition:"Exp"})},prepare:function(a,b){var c=this.element,d=c._.style,f=b||c.getStyle("color");f=[c].concat(c.parents()).map("getStyle","color").compact().first()||"#FFF";d.color=a||this.options.color;return this.$super({color:f})}});g.Element.include({move:function(a,b){return k(this,"move",[a,b||{}])},bounce:function(){return k(this,"bounce",arguments)},
zoom:function(a,b){return k(this,"zoom",[a,b||{}])},run:function(){return k(this,"run",arguments)},puff:function(){return k(this,"puff",arguments)},glow:function(){return k(this,"glow",arguments)}})})(RightJS);
